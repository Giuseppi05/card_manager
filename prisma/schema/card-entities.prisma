model Card {
  id        String  @id @default(cuid())
  name      String
  hp        Int?
  power     Int     @default(1)
  isActive  Boolean @default(false)
  isVisible Boolean @default(false)

  // --- RELACIONES ESTRUCTURALES ---
  expansionId String
  expansion   Expansion @relation(fields: [expansionId], references: [id])

  typeId   String
  cardType CardType @relation(fields: [typeId], references: [id])

  // --- MANY-TO-MANY IMPLÍCITOS ---
  classes      Class[]
  affiliations Affiliation[]
  isAffiliationMarked Boolean @default(false) 

  // --- TAGS UNIFICADOS ---
  // Relación muchos-a-muchos limpia. 
  // Una carta puede tener tags de "Dragon" (Raza) y "Fuego" (Elemento)
  tags Tag[]

  // --- GAMEPLAY ---
  moves Move[]

  // --- VARIANTES ---
  variants CardVariant[]

  // --- EVOLUCIÓN ---
  baseCardId   String?
  baseCard     Card?   @relation("CardLevels", fields: [baseCardId], references: [id])
  levelUpCards Card[]  @relation("CardLevels")

  userCards        UserCard[]
  userCardVariants UserCardVariant[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ==========================================
// CARD AESTHETICS (Variantes Visuales)
// ==========================================

model CardVariant {
  id     String @id @default(cuid())
  cardId String
  card   Card   @relation(fields: [cardId], references: [id])

  variantName String @default("default")

  // --- ASSETS VISUALES ---
  imageUrl      String
  fullRenderUrl String

  textureId String?
  texture   Texture? @relation(fields: [textureId], references: [id])

  longLogoId String?
  longLogo   Logo?   @relation("VariantVisualLogo", fields: [longLogoId], references: [id])

  // --- CUSTOMIZACIÓN ---
  bgColor     String? @default("#fbbf24")
  borderColor String? @default("#fbbf24")
  borderInternalColor String? @default("#fbbf24")
  textColor   String? @default("#000000")

  // --- POSICIONAMIENTO ---
  posX Float @default(0)
  posY Float @default(0)
  zoom Float @default(1)

  // --- ESTADOS ---
  isDefault Boolean @default(false)
  isActive  Boolean @default(false)

  owners UserCardVariant[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Move {
  id          String  @id @default(cuid())
  name        String
  damage      Int?
  description String?
  expandedDescription String?

  type   MoveType @relation(fields: [typeId], references: [id])
  typeId String

  cardId String
  card   Card   @relation(fields: [cardId], references: [id])

  // Relación directa con la tabla unificada de Tags
  tags Tag[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model MoveType {
  id     String @id @default(cuid())
  name   String @unique
  symbol String
  moves  Move[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- MODELO UNIFICADO DE TAGS ---
model Tag {
  id   String @id @default(cuid())
  name String @unique

  category TagCategory @default(CARD)

  // Relaciones inversas (Prisma las gestiona)
  cards Card[]
  moves Move[]

  gameId String
  game   Game @relation(fields: [gameId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum TagCategory {
  CARD
  MOVE
}
